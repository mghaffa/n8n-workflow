name: Grok Probe (xAI connectivity)

on:
  workflow_dispatch:
    inputs:
      model:
        description: "xAI model to test"
        type: choice
        options:
          - grok-2-mini
          - grok-2
          - grok-2-latest
          - grok-4-fast-reasoning
        default: grok-2-mini
      auth_scheme:
        description: "HTTP Authorization scheme (Bearer is correct)"
        type: choice
        options:
          - Bearer
          - xai-API   # this will intentionally fail; useful to prove scheme matters
        default: Bearer
      endpoint:
        description: "Endpoint to hit"
        type: choice
        options:
          - chat
          - responses
        default: chat

jobs:
  probe:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: "20"
      - name: Run probe
        env:
          XAI_API_KEY:     ${{ secrets.XAI_API_KEY }}
          XAI_MODEL:       ${{ github.event.inputs.model }}
          XAI_AUTH_SCHEME: ${{ github.event.inputs.auth_scheme }}
          XAI_ENDPOINT:    ${{ github.event.inputs.endpoint }}
        run: node runner/xai_probe.mjs
